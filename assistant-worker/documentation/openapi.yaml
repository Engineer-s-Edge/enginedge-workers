openapi: 3.0.3
info:
  title: Assistant Worker API
  description: |
    Comprehensive AI agent platform with support for multiple agent types, memory systems, and knowledge graphs.

    **Features:**
    - 6 specialized agent types
    - 5 memory systems
    - Neo4j knowledge graph
    - Real-time streaming
    - Human-in-the-loop support
  version: 1.0.0
  contact:
    name: API Support
    email: support@yourdomain.com
  license:
    name: Proprietary

servers:
  - url: http://localhost:3001
    description: Development server
  - url: https://assistant.yourdomain.com
    description: Production server

tags:
  - name: Agents
    description: Core agent operations
  - name: ReAct
    description: ReAct agent operations
  - name: Graph
    description: Graph agent operations
  - name: Expert
    description: Expert agent operations
  - name: Genius
    description: Genius agent operations
  - name: Collective
    description: Collective agent operations
  - name: Manager
    description: Manager agent operations
  - name: Memory
    description: Memory operations
  - name: Knowledge Graph
    description: Knowledge graph operations
  - name: Health
    description: Health and metrics

paths:
  /health:
    get:
      summary: Health check
      description: Check service health
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                  memory:
                    type: object
                    properties:
                      used:
                        type: number
                      total:
                        type: number

  /metrics:
    get:
      summary: Prometheus metrics
      description: Get Prometheus-formatted metrics
      tags:
        - Health
      responses:
        '200':
          description: Metrics data
          content:
            text/plain:
              schema:
                type: string

  /agents/create:
    post:
      summary: Create agent
      description: Create a new agent instance
      tags:
        - Agents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - userId
              properties:
                name:
                  type: string
                  example: my-assistant
                type:
                  type: string
                  enum: [react, graph, expert, genius, collective, manager]
                  example: react
                userId:
                  type: string
                  example: user123
                config:
                  type: object
                  properties:
                    model:
                      type: string
                      example: gpt-4
                    provider:
                      type: string
                      example: openai
                    temperature:
                      type: number
                      minimum: 0
                      maximum: 1
                      example: 0.7
                    maxTokens:
                      type: integer
                      example: 2048
                    systemPrompt:
                      type: string
                    enableTools:
                      type: boolean
                      example: true
                    toolNames:
                      type: array
                      items:
                        type: string
                    streamingEnabled:
                      type: boolean
                      example: true
                    timeout:
                      type: integer
                      example: 30000
      responses:
        '201':
          description: Agent created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: agent_1729776000_abc123
                  name:
                    type: string
                  type:
                    type: string
                  state:
                    type: string
                    example: idle
                  createdAt:
                    type: string
                    format: date-time
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /agents:
    get:
      summary: List agents
      description: Get list of agents for a user
      tags:
        - Agents
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [react, graph, expert, genius, collective, manager]
        - name: active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentSummary'

  /agents/{agentId}:
    get:
      summary: Get agent
      description: Get agent details
      tags:
        - Agents
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete agent
      description: Delete an agent
      tags:
        - Agents
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Agent deleted
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/{agentId}/execute:
    post:
      summary: Execute agent
      description: Execute agent with input
      tags:
        - Agents
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteRequest'
      responses:
        '200':
          description: Execution result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'
        '404':
          $ref: '#/components/responses/NotFound'
        '408':
          $ref: '#/components/responses/Timeout'

  /agents/{agentId}/stream:
    post:
      summary: Stream execution
      description: Execute agent with streaming
      tags:
        - Agents
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteRequest'
      responses:
        '200':
          description: Streaming response
          content:
            text/event-stream:
              schema:
                type: string

  /agents/{agentId}/abort:
    post:
      summary: Abort execution
      description: Abort agent execution
      tags:
        - Agents
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Execution aborted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string

  /agents/graph/{agentId}/hitl/queue:
    get:
      summary: Get global HITL queue
      description: Aggregate pending HITL interactions for a graph agent
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [green, yellow, red]
      responses:
        '200':
          description: Global HITL queue entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  filter:
                    type: string
                    nullable: true
                    enum: [green, yellow, red]
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphHitlQueueEntry'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/edges/{edgeId}/queue:
    get:
      summary: Get edge queue state
      description: Inspect queued payloads for a cyclic graph edge
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/EdgeId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Edge queue snapshot
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  edgeId:
                    type: string
                  queue:
                    $ref: '#/components/schemas/GraphEdgeQueueState'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/edges/{edgeId}/history:
    get:
      summary: Get edge input history
      description: Retrieve captured payloads that traversed the specified edge
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/EdgeId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: direction
          in: query
          required: false
          schema:
            type: string
            enum: [forward, backward]
        - name: start
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Edge history entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  edgeId:
                    type: string
                  limit:
                    type: integer
                    nullable: true
                  filters:
                    $ref: '#/components/schemas/GraphEdgeHistoryFilters'
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphEdgeHistoryEntry'
                  pageInfo:
                    $ref: '#/components/schemas/GraphEdgeHistoryPageInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/edges/{edgeId}/decisions:
    get:
      summary: Get edge decision history
      description: Retrieve conditional edge evaluation outcomes and metadata
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/EdgeId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: direction
          in: query
          required: false
          schema:
            type: string
            enum: [forward, backward]
        - name: start
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: end
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Edge decision entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  edgeId:
                    type: string
                  limit:
                    type: integer
                    nullable: true
                  filters:
                    $ref: '#/components/schemas/GraphEdgeHistoryFilters'
                  entries:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphEdgeDecisionEntry'
                  pageInfo:
                    $ref: '#/components/schemas/GraphEdgeHistoryPageInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/memory-groups:
    get:
      summary: List graph memory groups
      description: Return shared memory/RAG groups and node membership
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Memory group collection
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  total:
                    type: integer
                  groups:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphMemoryGroupState'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/memory-groups/{groupId}:
    get:
      summary: Get memory group detail
      description: Retrieve a single memory group configuration and usage metadata
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: groupId
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Memory group detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  group:
                    $ref: '#/components/schemas/GraphMemoryGroupState'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/edges/{edgeId}:
    patch:
      summary: Update edge checkpoint flag
      description: Mark or unmark a workflow edge as a runtime checkpoint trigger
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/EdgeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphEdgeCheckpointRequest'
      responses:
        '200':
          description: Updated edge definition
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  edgeId:
                    type: string
                  edge:
                    $ref: '#/components/schemas/WorkflowEdge'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/nodes/{nodeId}/convergence:
    get:
      summary: Get convergence state
      description: Retrieve the latest convergence resolution snapshot for a join node
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/NodeId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Convergence state payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  nodeId:
                    type: string
                  state:
                    $ref: '#/components/schemas/GraphConvergenceState'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/nodes/bulk-update:
    patch:
      summary: Bulk update node runtime settings
      description: Apply runtime configuration updates across multiple graph nodes using filter criteria
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphNodeBulkUpdateRequest'
      responses:
        '200':
          description: Bulk node update result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphBulkUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/nodes/{nodeId}/convergence-config:
    patch:
      summary: Update convergence wait configuration
      description: Configure how a join node waits for predecessors
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/NodeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphConvergenceConfigRequest'
      responses:
        '200':
          description: Updated convergence configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  nodeId:
                    type: string
                  config:
                    $ref: '#/components/schemas/GraphConvergenceConfig'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/nodes/{nodeId}/data-ordering:
    patch:
      summary: Update convergence data ordering
      description: Control ordering of incoming edge data for joins
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/NodeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphDataOrderingRequest'
      responses:
        '200':
          description: Updated data ordering
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  nodeId:
                    type: string
                  ordering:
                    $ref: '#/components/schemas/GraphDataOrdering'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/edges/bulk-update:
    patch:
      summary: Bulk update edge configuration
      description: Apply updates to multiple edges (labels, checkpoint flags, queue options)
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphEdgeBulkUpdateRequest'
      responses:
        '200':
          description: Bulk edge update result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphBulkUpdateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/checkpoints:
    get:
      summary: List runtime checkpoints
      description: Retrieve summaries for checkpoints captured while the graph executes
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Runtime checkpoint summaries
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  checkpoints:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphRuntimeCheckpointSummary'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/checkpoints/{checkpointId}:
    get:
      summary: Get runtime checkpoint snapshot
      description: Fetch the serialized execution snapshot captured at a checkpoint
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/CheckpointId'
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Runtime checkpoint snapshot
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  checkpointId:
                    type: string
                  snapshot:
                    $ref: '#/components/schemas/GraphExecutionSnapshot'
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/graph/{agentId}/checkpoints/{checkpointId}/restore:
    post:
      summary: Restore runtime checkpoint
      description: Restore the graph agent state using a runtime checkpoint snapshot
      tags:
        - Graph
      parameters:
        - $ref: '#/components/parameters/AgentId'
        - $ref: '#/components/parameters/CheckpointId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphCheckpointRestoreRequest'
      responses:
        '200':
          description: Checkpoint restored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                  checkpointId:
                    type: string
                  restored:
                    type: boolean
                  snapshot:
                    $ref: '#/components/schemas/GraphExecutionSnapshot'
        '404':
          $ref: '#/components/responses/NotFound'

  /memory/{conversationId}/messages:
    post:
      summary: Add message
      description: Add message to conversation memory
      tags:
        - Memory
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
                - content
              properties:
                role:
                  type: string
                  enum: [user, assistant, system]
                content:
                  type: string
                memoryType:
                  type: string
                  enum: [buffer, window, summary, vector, entity]
                  default: buffer
                metadata:
                  type: object
      responses:
        '201':
          description: Message added
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  conversationId:
                    type: string
                  messageAdded:
                    type: boolean

  /memory/{conversationId}:
    get:
      summary: Get messages
      description: Get conversation messages
      tags:
        - Memory
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
        - name: memoryType
          in: query
          schema:
            type: string
            enum: [buffer, window, summary, vector, entity]
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Conversation messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversationId:
                    type: string
                  memoryType:
                    type: string
                  messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/Message'
                  total:
                    type: integer
    delete:
      summary: Clear memory
      description: Clear conversation memory
      tags:
        - Memory
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
        - name: memoryType
          in: query
          schema:
            type: string
      responses:
        '204':
          description: Memory cleared

  /knowledge-graph/nodes:
    post:
      summary: Create node
      description: Create a knowledge graph node
      tags:
        - Knowledge Graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - label
                - type
                - layer
              properties:
                label:
                  type: string
                  example: Quantum Computing
                type:
                  type: string
                  example: concept
                layer:
                  type: string
                  enum: [L1_OBSERVATIONS, L2_PATTERNS, L3_MODELS, L4_THEORIES, L5_PRINCIPLES, L6_SYNTHESIS]
                properties:
                  type: object
      responses:
        '201':
          description: Node created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  node:
                    $ref: '#/components/schemas/KGNode'

  /knowledge-graph/nodes/{nodeId}:
    get:
      summary: Get node
      description: Get knowledge graph node
      tags:
        - Knowledge Graph
      parameters:
        - name: nodeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Node details
          content:
            application/json:
              schema:
                type: object
                properties:
                  node:
                    $ref: '#/components/schemas/KGNode'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  parameters:
    AgentId:
      name: agentId
      in: path
      required: true
      schema:
        type: string
      description: Agent identifier
    EdgeId:
      name: edgeId
      in: path
      required: true
      schema:
        type: string
      description: Workflow edge identifier
    NodeId:
      name: nodeId
      in: path
      required: true
      schema:
        type: string
      description: Workflow node identifier
    CheckpointId:
      name: checkpointId
      in: path
      required: true
      schema:
        type: string
      description: Runtime checkpoint identifier

  schemas:
    AgentSummary:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        state:
          type: string

    GraphHitlQueueEntry:
      type: object
      properties:
        interactionId:
          type: string
        sessionId:
          type: string
        nodeId:
          type: string
          nullable: true
        nodeName:
          type: string
          nullable: true
        hitlType:
          type: string
          enum: [green, yellow, red]
        interactionType:
          type: string
        prompt:
          type: string
        description:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        waitingMs:
          type: number

    GraphEdgeQueueItem:
      type: object
      properties:
        id:
          type: string
        payload:
          type: object
          additionalProperties: true
        enqueuedAt:
          type: string
          format: date-time
        sourceNodeId:
          type: string
        sourceNodeName:
          type: string
          nullable: true
        sourceExecutionId:
          type: string
          nullable: true

    GraphEdgeQueueState:
      type: object
      properties:
        edgeId:
          type: string
        from:
          type: string
        to:
          type: string
        depth:
          type: integer
        maxDepth:
          type: integer
        strategy:
          type: string
          enum: [fifo, lifo]
        isCyclic:
          type: boolean
        processedCount:
          type: integer
        droppedCount:
          type: integer
        lastUpdated:
          type: string
          format: date-time
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/GraphEdgeQueueItem'

    GraphEdgeHistoryEntry:
      type: object
      properties:
        edgeId:
          type: string
        fromNodeId:
          type: string
        fromNodeName:
          type: string
          nullable: true
        toNodeId:
          type: string
        toNodeName:
          type: string
          nullable: true
        payload:
          type: object
          nullable: true
          additionalProperties: true
        sourceExecutionId:
          type: string
          nullable: true
        timestamp:
          type: string
          format: date-time

    GraphEdgeDecisionEntry:
      type: object
      properties:
        edgeId:
          type: string
        nodeId:
          type: string
        nodeName:
          type: string
          nullable: true
        decisionResult:
          type: object
          nullable: true
          additionalProperties: true
        conditionLabel:
          type: string
          nullable: true
        matched:
          type: boolean
          nullable: true
        reason:
          type: string
          nullable: true
        sourceExecutionId:
          type: string
          nullable: true
        timestamp:
          type: string
          format: date-time

    GraphMemoryGroup:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        memoryType:
          type: string
          nullable: true
        provider:
          type: string
          nullable: true
        vectorStore:
          type: string
          nullable: true
        knowledgeGraphId:
          type: string
          nullable: true
        ragPipelineId:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
        metadata:
          type: object
          nullable: true
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true

    GraphMemoryGroupState:
      allOf:
        - $ref: '#/components/schemas/GraphMemoryGroup'
        - type: object
          properties:
            nodeIds:
              type: array
              items:
                type: string
            nodeNames:
              type: array
              items:
                type: string
            nodeCount:
              type: integer
            firstAccessedAt:
              type: string
              format: date-time
              nullable: true
            lastAccessedAt:
              type: string
              format: date-time
              nullable: true

    GraphEdgeHistoryFilters:
      type: object
      properties:
        cursor:
          type: string
          format: date-time
          nullable: true
        direction:
          type: string
          enum: [forward, backward]
          nullable: true
        start:
          type: string
          format: date-time
          nullable: true
        end:
          type: string
          format: date-time
          nullable: true

    GraphEdgeHistoryPageInfo:
      type: object
      properties:
        hasPreviousPage:
          type: boolean
        hasNextPage:
          type: boolean
        startCursor:
          type: string
          format: date-time
          nullable: true
        endCursor:
          type: string
          format: date-time
          nullable: true
        totalCount:
          type: integer

    WorkflowEdge:
      type: object
      properties:
        id:
          type: string
        from:
          type: string
        to:
          type: string
        label:
          type: string
          nullable: true
        conditionScript:
          type: string
          nullable: true
        isCheckpoint:
          type: boolean
          nullable: true

    GraphConvergenceConfigRequest:
      type: object
      required:
        - userId
        - strategy
      properties:
        userId:
          type: string
        strategy:
          type: string
          enum: [all, count, subset]
        count:
          type: integer
          minimum: 1
        edgeIds:
          type: array
          items:
            type: string
        nodeIds:
          type: array
          items:
            type: string

    GraphConvergenceConfig:
      type: object
      properties:
        strategy:
          type: string
          enum: [all, count, subset]
        count:
          type: integer
          minimum: 1
        edgeIds:
          type: array
          items:
            type: string
        nodeIds:
          type: array
          items:
            type: string

    GraphNodeBulkUpdateRequest:
      type: object
      required:
        - userId
        - updates
      properties:
        userId:
          type: string
        filter:
          type: object
          properties:
            provider:
              type: string
            model:
              type: string
            type:
              type: string
              enum:
                - task
                - decision
                - parallel_split
                - parallel_join
                - error_handler
                - start
                - end
            tags:
              type: array
              items:
                type: string
        updates:
          type: object
          properties:
            provider:
              type: string
            model:
              type: string
            memoryType:
              type: string
            vectorStore:
              type: string
            config:
              type: object
              additionalProperties: true

    GraphEdgeBulkUpdateRequest:
      type: object
      required:
        - userId
        - updates
      properties:
        userId:
          type: string
        filter:
          type: object
          properties:
            fromNodeId:
              type: string
            toNodeId:
              type: string
            label:
              type: string
            isCheckpoint:
              type: boolean
        updates:
          type: object
          properties:
            label:
              type: string
            isCheckpoint:
              type: boolean
            queue:
              $ref: '#/components/schemas/EdgeQueueConfig'

    GraphBulkUpdateResponse:
      type: object
      properties:
        agentId:
          type: string
        updatedCount:
          type: integer
        nodeIds:
          type: array
          items:
            type: string
        edgeIds:
          type: array
          items:
            type: string

    GraphConvergenceInput:
      type: object
      properties:
        edgeId:
          type: string
        nodeId:
          type: string
        nodeName:
          type: string
          nullable: true
        output:
          type: object
          description: Serialized node output captured when the join resolved
          nullable: true

    GraphConvergenceState:
      type: object
      properties:
        nodeId:
          type: string
        strategy:
          type: string
          enum: [all, count, subset]
        requiredCount:
          type: integer
        satisfiedCount:
          type: integer
        pendingSources:
          type: array
          items:
            type: string
        ordering:
          type: array
          items:
            type: string
        inputs:
          type: array
          items:
            $ref: '#/components/schemas/GraphConvergenceInput'
        updatedAt:
          type: string
          format: date-time

    GraphDataOrderingRequest:
      type: object
      required:
        - userId
        - mode
      properties:
        userId:
          type: string
        mode:
          type: string
          enum: [arrival, explicit]
        order:
          type: array
          items:
            type: string
        includeDuplicates:
          type: boolean

    GraphDataOrdering:
      type: object
      properties:
        mode:
          type: string
          enum: [arrival, explicit]
        order:
          type: array
          items:
            type: string
        includeDuplicates:
          type: boolean

    GraphEdgeCheckpointRequest:
      type: object
      required:
        - userId
        - isCheckpoint
      properties:
        userId:
          type: string
        isCheckpoint:
          type: boolean

    GraphCheckpointRestoreRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string

    GraphRuntimeCheckpointSummary:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [edge]
        edgeId:
          type: string
        fromNodeId:
          type: string
        toNodeId:
          type: string
        label:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    GraphExecutionSnapshot:
      type: object
      description: Serialized graph execution state captured at checkpoint time
      properties:
        graphId:
          type: string
          nullable: true
        graphName:
          type: string
          nullable: true
        startTime:
          type: number
          nullable: true
        lastUpdated:
          type: number
          nullable: true
        currentNodeIds:
          type: array
          items:
            type: string
        pendingNodeIds:
          type: array
          items:
            type: string
        nodeResults:
          type: array
          items:
            type: object
            properties:
              nodeId:
                type: string
              output:
                type: object
                additionalProperties: true
        retryAttempts:
          type: object
          additionalProperties:
            type: integer
        edgeQueues:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/GraphEdgeQueueState'
        edgeHistory:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/GraphEdgeHistoryEntry'
        edgeDecisions:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/GraphEdgeDecisionEntry'

    Agent:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        state:
          type: string
        config:
          type: object

    ExecuteRequest:
      type: object
      required:
        - input
        - userId
      properties:
        input:
          type: string
        userId:
          type: string
        sessionId:
          type: string
        conversationId:
          type: string

    ExecutionResult:
      type: object
      properties:
        output:
          type: string
        status:
          type: string
        executionTime:
          type: number
        tokenCount:
          type: object
          properties:
            input:
              type: integer
            output:
              type: integer
        metadata:
          type: object

    Message:
      type: object
      properties:
        role:
          type: string
          enum: [user, assistant, system]
        content:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object

    KGNode:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        type:
          type: string
        layer:
          type: string
        properties:
          type: object
        createdAt:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        statusCode:
          type: integer
        message:
          type: string
        error:
          type: string
        timestamp:
          type: string
          format: date-time
        path:
          type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        field:
                          type: string
                        message:
                          type: string

    Timeout:
      description: Request timeout
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
