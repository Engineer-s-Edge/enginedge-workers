openapi: 3.0.3
info:
  title: Agent Tool Worker API
  description: |
    Comprehensive agent tool execution platform with 50+ integrated tools.
    
    **Features:**
    - 12 Retriever Tools (Web search, File system, Databases, APIs, OCR, Video transcripts)
    - 13 Actor Tools (Filesystem, HTTP requests, Google Calendar/Drive, Notion, Todoist, VirusTotal, Mermaid, Terminal)
    - Tool registry and discovery system
    - OAuth token management for external integrations
    - Rate limiting and quota management
    - Tool validation and caching
    - Batch and parallel execution
    - Real-time metrics and monitoring
    
    **Tool Categories:**
    - **Retrievers:** Data retrieval and search operations
      - Web Search (Tavily)
      - File System access
      - Database queries (LocalDB)
      - API data retrieval (cURL, Weather, Wolfram)
      - OCR processing
      - YouTube transcripts
      - Google Drive, Notion, Todoist
    
    - **Actors:** Action execution and workflow operations
      - Filesystem operations
      - HTTP requests
      - Google Calendar (events, scheduling)
      - Google Drive (upload, share, organize)
      - Notion (pages, databases)
      - Todoist (tasks, projects)
      - VirusTotal (security scanning)
      - Mermaid diagram generation
      - Terminal command execution
      - Internal TODO management
      - Local database operations
  version: 1.0.0
  contact:
    name: API Support
    email: support@yourdomain.com
  license:
    name: Proprietary
    
servers:
  - url: http://localhost:3001
    description: Development server
  - url: https://agent-tool.yourdomain.com
    description: Production server

tags:
  - name: Health
    description: Health check and service status
  - name: Commands
    description: Command processing operations
  - name: Tools
    description: Tool management and discovery
  - name: Execution
    description: Tool execution operations
  - name: Retrievers
    description: Data retrieval tools
  - name: Actors
    description: Action execution tools
  - name: OAuth
    description: OAuth token management
  - name: Rate Limiting
    description: Rate limit monitoring and management
  - name: Metrics
    description: Tool metrics and statistics

paths:
  /health:
    get:
      summary: Health check
      description: Check service health and readiness
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                    description: Uptime in seconds
                  memory:
                    type: object
                    properties:
                      used:
                        type: number
                      total:
                        type: number
                  services:
                    type: object
                    properties:
                      toolRegistry:
                        type: boolean
                      rateLimiter:
                        type: boolean
                      cache:
                        type: boolean

  /command/process:
    post:
      summary: Process command
      description: Process a tool execution command
      tags:
        - Commands
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Command'
      responses:
        '200':
          description: Command processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommandResult'
        '400':
          $ref: '#/components/responses/BadRequest'

  /tools:
    get:
      summary: List all tools
      description: Get list of all registered tools with filtering options
      tags:
        - Tools
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [actor, retriever]
          description: Filter by tool type
        - name: category
          in: query
          schema:
            type: string
          description: Filter by actor category
        - name: retrievalType
          in: query
          schema:
            type: string
          description: Filter by retrieval type
        - name: enabled
          in: query
          schema:
            type: boolean
          description: Filter by enabled status
      responses:
        '200':
          description: List of tools
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tools:
                        type: array
                        items:
                          $ref: '#/components/schemas/ToolSummary'
                      totalTools:
                        type: integer
                      categories:
                        type: object
                        properties:
                          retrievers:
                            type: integer
                          actors:
                            type: integer

  /tools/{toolName}:
    get:
      summary: Get tool details
      description: Get detailed information about a specific tool
      tags:
        - Tools
      parameters:
        - $ref: '#/components/parameters/ToolName'
      responses:
        '200':
          description: Tool details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/ToolDetails'
        '404':
          $ref: '#/components/responses/NotFound'

  /tools/register:
    post:
      summary: Register custom tool
      description: Register a new custom tool in the registry
      tags:
        - Tools
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - description
              properties:
                name:
                  type: string
                  example: custom_api_retriever
                type:
                  type: string
                  enum: [actor, retriever]
                description:
                  type: string
                handlerPath:
                  type: string
                  description: Path to tool handler implementation
                authentication:
                  type: string
                  enum: [none, api_key, oauth2, bearer_token]
                config:
                  type: object
                  properties:
                    timeout:
                      type: integer
                      default: 30000
                    retries:
                      type: integer
                      default: 3
                    caching:
                      type: boolean
                      default: false
      responses:
        '201':
          description: Tool registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      toolId:
                        type: string
                      name:
                        type: string
                      registered:
                        type: boolean
                      timestamp:
                        type: string
                        format: date-time

  /tools/{toolName}/execute:
    post:
      summary: Execute tool
      description: Execute a tool with provided input parameters
      tags:
        - Execution
      parameters:
        - $ref: '#/components/parameters/ToolName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteRequest'
      responses:
        '200':
          description: Tool executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /tools/{toolName}/validate:
    post:
      summary: Validate tool input
      description: Validate tool input without executing
      tags:
        - Execution
      parameters:
        - $ref: '#/components/parameters/ToolName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - input
              properties:
                input:
                  type: object
                  additionalProperties: true
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  valid:
                    type: boolean
                  errors:
                    type: array
                    items:
                      type: object
                      properties:
                        field:
                          type: string
                        message:
                          type: string

  /tools/batch/execute:
    post:
      summary: Batch execute tools
      description: Execute multiple tools in parallel or sequential mode
      tags:
        - Execution
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - requests
              properties:
                requests:
                  type: array
                  items:
                    type: object
                    required:
                      - toolName
                      - input
                    properties:
                      toolName:
                        type: string
                      input:
                        type: object
                        additionalProperties: true
                      credentials:
                        type: object
                        additionalProperties: true
                parallel:
                  type: boolean
                  default: true
                  description: Execute tools in parallel vs sequential
                timeout:
                  type: integer
                  default: 60000
                  description: Overall timeout in milliseconds
      responses:
        '200':
          description: Batch execution results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            toolName:
                              type: string
                            status:
                              type: string
                              enum: [success, failure]
                            result:
                              type: object
                            error:
                              type: object
                            executionTime:
                              type: number
                      totalExecutionTime:
                        type: number
                      successCount:
                        type: integer
                      failureCount:
                        type: integer

  /tools/{toolName}/metrics:
    get:
      summary: Get tool metrics
      description: Get execution statistics and performance metrics for a tool
      tags:
        - Metrics
      parameters:
        - $ref: '#/components/parameters/ToolName'
      responses:
        '200':
          description: Tool metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      toolName:
                        type: string
                      totalExecutions:
                        type: integer
                      successRate:
                        type: number
                        description: Success rate (0-1)
                      averageDuration:
                        type: number
                        description: Average execution time in milliseconds
                      errorCount:
                        type: integer
                      lastExecuted:
                        type: string
                        format: date-time
                      cacheHitRate:
                        type: number

  /tools/{toolName}/cache/clear:
    post:
      summary: Clear tool cache
      description: Clear cached results for a specific tool
      tags:
        - Execution
      parameters:
        - $ref: '#/components/parameters/ToolName'
      responses:
        '200':
          description: Cache cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  clearedEntries:
                    type: integer

  /retrievers/tavily/search:
    post:
      summary: Web search (Tavily)
      description: Search the web using Tavily search engine
      tags:
        - Retrievers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  example: quantum computing applications
                max_results:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 10
                search_depth:
                  type: string
                  enum: [basic, advanced]
                  default: basic
                include_images:
                  type: boolean
                  default: false
                include_answer:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /retrievers/google-drive/search:
    post:
      summary: Google Drive search
      description: Search and retrieve files from Google Drive
      tags:
        - Retrievers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  example: project documents
                folder_id:
                  type: string
                file_types:
                  type: array
                  items:
                    type: string
                  example: [pdf, doc, spreadsheet]
                owner:
                  type: string
                modified_after:
                  type: string
                  format: date
                modified_before:
                  type: string
                  format: date
                max_results:
                  type: integer
                  default: 10
                order_by:
                  type: string
                  enum: [modifiedTime, createdTime, name, size]
      responses:
        '200':
          description: Drive files
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /retrievers/notion/search:
    post:
      summary: Notion search
      description: Query and retrieve pages from Notion
      tags:
        - Retrievers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                database_id:
                  type: string
                filter:
                  type: object
                  additionalProperties: true
                sort:
                  type: array
                  items:
                    type: object
                    properties:
                      property:
                        type: string
                      direction:
                        type: string
                        enum: [ascending, descending]
                max_results:
                  type: integer
                  default: 25
      responses:
        '200':
          description: Notion pages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /retrievers/youtube/transcript:
    post:
      summary: YouTube transcript
      description: Retrieve transcript from YouTube video
      tags:
        - Retrievers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - video_id
              properties:
                video_id:
                  type: string
                  example: dQw4w9WgXcQ
                language:
                  type: string
                  default: en
                  example: en
      responses:
        '200':
          description: Video transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /actors/filesystem/execute:
    post:
      summary: Filesystem operations
      description: Execute filesystem operations (read, write, delete, list)
      tags:
        - Actors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - path
              properties:
                operation:
                  type: string
                  enum: [read, write, delete, list, mkdir, copy, move]
                path:
                  type: string
                  example: /data/documents/report.pdf
                content:
                  type: string
                  description: Content for write operations
                destination:
                  type: string
                  description: Destination for copy/move operations
      responses:
        '200':
          description: Operation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /actors/google-calendar/event:
    post:
      summary: Google Calendar event
      description: Create, update, or delete Google Calendar events
      tags:
        - Actors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [create, update, delete, list]
                event:
                  type: object
                  properties:
                    summary:
                      type: string
                      example: Team Meeting
                    description:
                      type: string
                    start:
                      type: object
                      properties:
                        dateTime:
                          type: string
                          format: date-time
                        timeZone:
                          type: string
                          example: America/New_York
                    end:
                      type: object
                      properties:
                        dateTime:
                          type: string
                          format: date-time
                        timeZone:
                          type: string
                    attendees:
                      type: array
                      items:
                        type: object
                        properties:
                          email:
                            type: string
                eventId:
                  type: string
                  description: Event ID for update/delete operations
      responses:
        '200':
          description: Calendar event result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /actors/todoist/task:
    post:
      summary: Todoist task
      description: Manage Todoist tasks (create, update, complete, delete)
      tags:
        - Actors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [create, update, complete, delete, list]
                task:
                  type: object
                  properties:
                    content:
                      type: string
                      example: Review Q4 report
                    description:
                      type: string
                    due_date:
                      type: string
                      format: date
                    priority:
                      type: integer
                      minimum: 1
                      maximum: 4
                    project_id:
                      type: string
                    labels:
                      type: array
                      items:
                        type: string
                taskId:
                  type: string
      responses:
        '200':
          description: Task operation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /actors/virustotal/scan:
    post:
      summary: VirusTotal scan
      description: Scan files or URLs using VirusTotal
      tags:
        - Actors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - target
              properties:
                type:
                  type: string
                  enum: [file, url, domain, ip]
                target:
                  type: string
                  description: File hash, URL, domain, or IP address
      responses:
        '200':
          description: Scan results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /actors/mermaid/generate:
    post:
      summary: Mermaid diagram
      description: Generate Mermaid diagram from specification
      tags:
        - Actors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - diagram
              properties:
                diagram:
                  type: string
                  example: |
                    graph TD
                      A[Start] --> B{Decision}
                      B -->|Yes| C[Action 1]
                      B -->|No| D[Action 2]
                format:
                  type: string
                  enum: [svg, png, pdf]
                  default: svg
      responses:
        '200':
          description: Generated diagram
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecutionResult'

  /oauth/tokens:
    get:
      summary: List OAuth tokens
      description: List all stored OAuth tokens
      tags:
        - OAuth
      parameters:
        - name: provider
          in: query
          schema:
            type: string
          description: Filter by OAuth provider
      responses:
        '200':
          description: OAuth tokens list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tokens:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            provider:
                              type: string
                            userId:
                              type: string
                            expiresAt:
                              type: string
                              format: date-time
                            scopes:
                              type: array
                              items:
                                type: string

  /oauth/tokens/{provider}:
    post:
      summary: Store OAuth token
      description: Store or update OAuth token for a provider
      tags:
        - OAuth
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [google, notion, todoist, github]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - accessToken
                - userId
              properties:
                accessToken:
                  type: string
                refreshToken:
                  type: string
                expiresIn:
                  type: integer
                  description: Token expiry in seconds
                userId:
                  type: string
                scopes:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Token stored
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  tokenId:
                    type: string

    delete:
      summary: Delete OAuth token
      description: Delete stored OAuth token for a provider
      tags:
        - OAuth
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: query
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Token deleted

  /rate-limits:
    get:
      summary: Get rate limits
      description: Get rate limit status for all tools
      tags:
        - Rate Limiting
      responses:
        '200':
          description: Rate limit status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tools:
                        type: array
                        items:
                          type: object
                          properties:
                            toolName:
                              type: string
                            limit:
                              type: string
                              example: 1000 requests/day
                            current:
                              type: integer
                            remaining:
                              type: integer
                            resetTime:
                              type: string
                              format: date-time

  /rate-limits/{toolName}:
    get:
      summary: Get tool rate limit
      description: Get rate limit status for a specific tool
      tags:
        - Rate Limiting
      parameters:
        - $ref: '#/components/parameters/ToolName'
      responses:
        '200':
          description: Tool rate limit status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      toolName:
                        type: string
                      limit:
                        type: string
                      current:
                        type: integer
                      remaining:
                        type: integer
                      resetTime:
                        type: string
                        format: date-time
                      retryAfter:
                        type: integer
                        description: Seconds until rate limit resets

components:
  parameters:
    ToolName:
      name: toolName
      in: path
      required: true
      schema:
        type: string
      description: Tool identifier
      example: google_drive_retriever

  schemas:
    Command:
      type: object
      required:
        - action
      properties:
        action:
          type: string
          enum: [execute_tool, register_tool, list_tools]
        payload:
          type: object
          additionalProperties: true
        options:
          type: object
          additionalProperties: true

    CommandResult:
      type: object
      properties:
        success:
          type: boolean
        action:
          type: string
        result:
          type: object
          additionalProperties: true
        metadata:
          type: object
          properties:
            executionTime:
              type: number
            timestamp:
              type: string
              format: date-time

    ToolSummary:
      type: object
      properties:
        name:
          type: string
          example: google_drive_retriever
        type:
          type: string
          enum: [actor, retriever]
        description:
          type: string
        authentication:
          type: string
          enum: [none, api_key, oauth2, bearer_token]
        rateLimit:
          type: string
          example: 10000 requests/day
        enabled:
          type: boolean
        category:
          type: string
        retrievalType:
          type: string

    ToolDetails:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum: [actor, retriever]
        description:
          type: string
        version:
          type: string
        authentication:
          type: object
          properties:
            type:
              type: string
            requiredScopes:
              type: array
              items:
                type: string
        inputSchema:
          type: object
          additionalProperties: true
          description: JSON Schema for tool input validation
        rateLimit:
          type: object
          properties:
            requestsPerDay:
              type: integer
            requestsPerSecond:
              type: integer
        endpoints:
          type: array
          items:
            type: string
          description: External API endpoints used by this tool

    ExecuteRequest:
      type: object
      required:
        - input
      properties:
        input:
          type: object
          additionalProperties: true
          description: Tool-specific input parameters
        credentials:
          type: object
          additionalProperties: true
          description: Authentication credentials (API keys, OAuth tokens)
        timeout:
          type: integer
          default: 30000
          description: Execution timeout in milliseconds
        retryPolicy:
          type: string
          enum: [none, exponential, linear]
          default: exponential
        caching:
          type: boolean
          default: true
          description: Enable result caching

    ExecutionResult:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            toolName:
              type: string
            result:
              type: object
              additionalProperties: true
              description: Tool-specific result data
            metadata:
              type: object
              properties:
                cached:
                  type: boolean
                attempts:
                  type: integer
        executionTime:
          type: number
          description: Execution time in milliseconds
        timestamp:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        success:
          type: boolean
          enum: [false]
        error:
          type: object
          properties:
            code:
              type: string
              example: TOOL_NOT_FOUND
            message:
              type: string
            statusCode:
              type: integer
            details:
              type: object
              additionalProperties: true
        timestamp:
          type: string
          format: date-time
        path:
          type: string

  responses:
    BadRequest:
      description: Bad request - invalid parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: VALIDATION_ERROR
              message: Input validation failed
              statusCode: 400
              details:
                fields:
                  query: Query is required

    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: AUTHENTICATION_FAILED
              message: Invalid OAuth token
              statusCode: 401

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: TOOL_NOT_FOUND
              message: Tool 'invalid_tool' not found
              statusCode: 404

    RateLimitExceeded:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: RATE_LIMIT_EXCEEDED
              message: Rate limit exceeded for Google Drive API
              statusCode: 429
              details:
                retryAfter: 45
                limit: 10000 requests/day
                resetTime: '2025-10-26T00:00:00.000Z'

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication
    
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication
    
    OAuth2:
      type: oauth2
      description: OAuth 2.0 authentication for external services
      flows:
        authorizationCode:
          authorizationUrl: https://accounts.google.com/o/oauth2/auth
          tokenUrl: https://oauth2.googleapis.com/token
          scopes:
            drive.readonly: Read-only access to Google Drive
            calendar: Access to Google Calendar
            notion: Access to Notion workspaces

security:
  - ApiKeyAuth: []
  - BearerAuth: []
