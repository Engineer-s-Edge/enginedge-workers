openapi: 3.0.3
info:
  title: Resume Worker API
  description: AI-powered resume generation, evaluation, and tailoring platform
  version: 1.0.0
  contact:
    name: EnginEdge Team
    email: support@enginedge.com
  license:
    name: Proprietary
    url: https://enginedge.com/license

servers:
  - url: http://localhost:3006
    description: Development server
  - url: https://resume.enginedge.com
    description: Production server

tags:
  - name: Experience Bank
    description: Manage bullet point library with vector search
  - name: Resume
    description: CRUD operations for resumes
  - name: Job Posting
    description: Extract and manage job postings
  - name: Evaluation
    description: Evaluate resumes and bullets
  - name: Tailoring
    description: Full resume tailoring workflow
  - name: Editing
    description: LaTeX editing operations
  - name: Cover Letter
    description: Generate tailored cover letters
  - name: Health
    description: Health checks and metrics

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns service health status
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                    example: 123.45

  /metrics:
    get:
      tags:
        - Health
      summary: Prometheus metrics
      description: Returns Prometheus-formatted metrics
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string

  /experience-bank/add:
    post:
      tags:
        - Experience Bank
      summary: Add bullet point
      description: Add a new bullet point to the experience bank
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - bulletText
              properties:
                userId:
                  type: string
                  example: user123
                bulletText:
                  type: string
                  example: Developed scalable microservices reducing deployment time by 60%
                metadata:
                  type: object
                  properties:
                    technologies:
                      type: array
                      items:
                        type: string
                      example: [Node.js, Docker, Kubernetes]
                    role:
                      type: string
                      example: Software Engineer
                    company:
                      type: string
                      example: Tech Corp
                    dateRange:
                      type: string
                      example: 2022-2024
                    reviewed:
                      type: boolean
                      default: false
                    category:
                      type: string
                      enum: [work, project, education]
                      default: work
      responses:
        '201':
          description: Bullet point created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExperienceBankItem'
        '400':
          $ref: '#/components/responses/BadRequest'

  /experience-bank/search:
    post:
      tags:
        - Experience Bank
      summary: Search experience bank
      description: Search for bullet points using vector search and metadata filters
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: string
                query:
                  type: string
                  example: microservices deployment
                filters:
                  type: object
                  properties:
                    technologies:
                      type: array
                      items:
                        type: string
                    reviewed:
                      type: boolean
                    minImpactScore:
                      type: number
                      minimum: 0
                      maximum: 1
                    category:
                      type: string
                      enum: [work, project, education]
                limit:
                  type: integer
                  default: 10
                  minimum: 1
                  maximum: 100
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExperienceBankItem'
                  total:
                    type: integer

  /experience-bank/list/{userId}:
    get:
      tags:
        - Experience Bank
      summary: List bullets
      description: List all bullets for a user with optional filters
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
        - name: reviewed
          in: query
          schema:
            type: boolean
        - name: category
          in: query
          schema:
            type: string
            enum: [work, project, education]
      responses:
        '200':
          description: List of bullets
          content:
            application/json:
              schema:
                type: object
                properties:
                  bullets:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExperienceBankItem'
                  total:
                    type: integer

  /experience-bank/{id}/reviewed:
    patch:
      tags:
        - Experience Bank
      summary: Mark as reviewed
      description: Mark a bullet point as reviewed
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bullet marked as reviewed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExperienceBankItem'

  /experience-bank/{id}:
    get:
      tags:
        - Experience Bank
      summary: Get bullet by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bullet point
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExperienceBankItem'
        '404':
          $ref: '#/components/responses/NotFound'

  /resume/create:
    post:
      tags:
        - Resume
      summary: Create resume
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - name
                - latexContent
              properties:
                userId:
                  type: string
                name:
                  type: string
                latexContent:
                  type: string
                metadata:
                  type: object
      responses:
        '201':
          description: Resume created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Resume'

  /resume/{id}:
    get:
      tags:
        - Resume
      summary: Get resume
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Resume
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Resume'
    patch:
      tags:
        - Resume
      summary: Update resume
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                latexContent:
                  type: string
                metadata:
                  type: object
      responses:
        '200':
          description: Resume updated
    delete:
      tags:
        - Resume
      summary: Delete resume
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Resume deleted

  /job-posting/extract:
    post:
      tags:
        - Job Posting
      summary: Extract job posting
      description: Extract structured information from a job posting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - rawText
              properties:
                userId:
                  type: string
                url:
                  type: string
                rawText:
                  type: string
                rawHtml:
                  type: string
                mode:
                  type: string
                  enum: [nlp-only, llm-assisted]
                  default: nlp-only
      responses:
        '201':
          description: Job posting extracted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'

  /job-posting/{id}:
    get:
      tags:
        - Job Posting
      summary: Get job posting
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job posting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'
    delete:
      tags:
        - Job Posting
      summary: Delete job posting
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job posting deleted

  /job-posting/list/{userId}:
    get:
      tags:
        - Job Posting
      summary: List job postings
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of job postings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobPosting'

  /evaluation/evaluate:
    post:
      tags:
        - Evaluation
      summary: Evaluate resume
      description: Evaluate an entire resume
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - resumeId
              properties:
                resumeId:
                  type: string
                mode:
                  type: string
                  enum: [standalone, role-guided, jd-match]
                  default: standalone
                jobPostingId:
                  type: string
                targetRole:
                  type: string
                options:
                  type: object
                  properties:
                    autoFix:
                      type: boolean
                      default: true
                    includeSwaps:
                      type: boolean
                      default: true
      responses:
        '201':
          description: Evaluation complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationReport'

  /evaluation/report/{id}:
    get:
      tags:
        - Evaluation
      summary: Get evaluation report
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Evaluation report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationReport'

  /evaluation/reports/{resumeId}:
    get:
      tags:
        - Evaluation
      summary: List evaluation reports
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of reports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvaluationReport'

  /tailoring/tailor:
    post:
      tags:
        - Tailoring
      summary: Tailor resume
      description: Start full resume tailoring workflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - resumeId
                - jobPostingText
              properties:
                userId:
                  type: string
                resumeId:
                  type: string
                jobPostingText:
                  type: string
                mode:
                  type: string
                  enum: [auto, manual]
                  default: auto
                targetScore:
                  type: number
                  default: 95
                  minimum: 0
                  maximum: 100
                options:
                  type: object
                  properties:
                    maxIterations:
                      type: integer
                      default: 5
                    autoApplyFixes:
                      type: boolean
                      default: true
      responses:
        '202':
          description: Tailoring job started
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  status:
                    type: string
                    enum: [queued, processing]
                  estimatedTime:
                    type: integer

  /tailoring/job/{jobId}:
    get:
      tags:
        - Tailoring
      summary: Get job status
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  status:
                    type: string
                    enum: [queued, processing, completed, failed, cancelled]
                  progress:
                    type: integer
                  currentScore:
                    type: number
                  targetScore:
                    type: number
                  iterations:
                    type: integer
                  message:
                    type: string

  /tailoring/job/{jobId}/cancel:
    post:
      tags:
        - Tailoring
      summary: Cancel job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job cancelled

  /editing/{resumeId}/latex:
    post:
      tags:
        - Editing
      summary: Apply LaTeX operation
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - text
              properties:
                operation:
                  type: string
                  enum: [bold, italic, underline, replace, insert, delete]
                text:
                  type: string
                position:
                  type: integer
      responses:
        '200':
          description: Operation applied

  /editing/{resumeId}/undo:
    post:
      tags:
        - Editing
      summary: Undo last change
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Change undone

  /editing/{resumeId}/redo:
    post:
      tags:
        - Editing
      summary: Redo last undone change
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Change redone

  /editing/{resumeId}/preview:
    post:
      tags:
        - Editing
      summary: Generate preview
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Preview generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  pdfUrl:
                    type: string
                  expiresAt:
                    type: string
                    format: date-time

  /editing/{resumeId}/suggest-swaps:
    post:
      tags:
        - Editing
      summary: Suggest bullet swaps
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                jobPostingId:
                  type: string
                limit:
                  type: integer
                  default: 5
      responses:
        '200':
          description: Suggestions generated
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    currentBullet:
                      type: string
                    suggestedBullet:
                      type: string
                    reason:
                      type: string
                    confidence:
                      type: number

  /editing/{resumeId}/apply-swap:
    post:
      tags:
        - Editing
      summary: Apply bullet swap
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldBulletId
                - newBulletId
              properties:
                oldBulletId:
                  type: string
                newBulletId:
                  type: string
      responses:
        '200':
          description: Swap applied

  /cover-letter/generate:
    post:
      tags:
        - Cover Letter
      summary: Generate cover letter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - options
              properties:
                userId:
                  type: string
                options:
                  type: object
                  required:
                    - jobPostingId
                  properties:
                    jobPostingId:
                      type: string
                    tone:
                      type: string
                      enum: [professional, casual, enthusiastic]
                      default: professional
                    length:
                      type: string
                      enum: [short, medium, long]
                      default: medium
                    includeExperiences:
                      type: array
                      items:
                        type: string
      responses:
        '201':
          description: Cover letter generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CoverLetter'

  /cover-letter/{id}/regenerate:
    post:
      tags:
        - Cover Letter
      summary: Regenerate cover letter
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                options:
                  type: object
      responses:
        '200':
          description: Cover letter regenerated

  /cover-letter/{id}:
    patch:
      tags:
        - Cover Letter
      summary: Edit cover letter
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
      responses:
        '200':
          description: Cover letter updated

components:
  schemas:
    ExperienceBankItem:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        bulletText:
          type: string
        vector:
          type: array
          items:
            type: number
        vectorModel:
          type: string
          example: text-embedding-004
        metadata:
          type: object
          properties:
            technologies:
              type: array
              items:
                type: string
            role:
              type: string
            company:
              type: string
            dateRange:
              type: string
            reviewed:
              type: boolean
            category:
              type: string
              enum: [work, project, education]
            impactScore:
              type: number
            atsScore:
              type: number
        hash:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Resume:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        name:
          type: string
        latexContent:
          type: string
        currentVersion:
          type: integer
        versions:
          type: array
          items:
            type: object
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    JobPosting:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        url:
          type: string
        rawText:
          type: string
        parsed:
          type: object
        extractionMethod:
          type: string
          enum: [nlp-only, llm-assisted]
        confidence:
          type: number
        createdAt:
          type: string
          format: date-time

    EvaluationReport:
      type: object
      properties:
        _id:
          type: string
        resumeId:
          type: string
        userId:
          type: string
        mode:
          type: string
          enum: [standalone, role-guided, jd-match]
        scores:
          type: object
          properties:
            overall:
              type: number
            structure:
              type: number
            ats:
              type: number
            content:
              type: number
            alignment:
              type: number
        gates:
          type: object
        findings:
          type: array
          items:
            type: object
        coverage:
          type: object
        suggestedSwaps:
          type: array
          items:
            type: object
        createdAt:
          type: string
          format: date-time

    CoverLetter:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        jobPostingId:
          type: string
        content:
          type: string
        metadata:
          type: object
        createdAt:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            properties:
              statusCode:
                type: integer
                example: 400
              message:
                type: string
              error:
                type: string
                example: Bad Request

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              statusCode:
                type: integer
                example: 404
              message:
                type: string
              error:
                type: string
                example: Not Found
